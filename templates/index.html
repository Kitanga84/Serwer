{% extends "base.html" %}
{% block title %}Dateiübersicht{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Willkommen, {{ username }}!</h2>
    <a href="{{ url_for('logout') }}" class="btn btn-outline-secondary">Abmelden</a>
  </div>

  <!-- Datei Hochladen -->
  <div class="card mb-4">
    <div class="card-header">Datei hochladen</div>
    <div class="card-body">
      <form action="{{ url_for('upload') }}" method="POST" enctype="multipart/form-data" class="row g-3">
        <div class="col-auto">
          <input type="file" name="file" class="form-control" required>
        </div>
        <div class="col-auto">
          <select name="target" class="form-select">
            <option value="{{ username }}" selected>Privater Ordner</option>
            <option value="shared">Gemeinsamer Ordner</option>
          </select>
        </div>
        <div class="col-auto">
          <button type="submit" class="btn btn-success">Hochladen</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Eigene Dateien -->
  <h4>Eigene Dateien</h4>
  {% if user_files %}
    <ul class="list-group mb-4">
      {% for file in user_files %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ file }}
        <span>
          <a href="{{ url_for('download', folder=username, filename=file) }}" class="btn btn-sm btn-primary">Herunterladen</a>
          <a href="{{ url_for('delete_file', folder=username, filename=file) }}" class="btn btn-sm btn-danger ms-2" onclick="return confirm('Datei wirklich löschen?')">Löschen</a>
        </span>
      </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Keine Dateien im privaten Ordner.</p>
  {% endif %}

  <!-- Gemeinsame Dateien -->
  <h4>Gemeinsamer Ordner</h4>
  {% if shared_files %}
    <ul class="list-group mb-4">
      {% for file in shared_files %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        {{ file }}
        <span>
          <a href="{{ url_for('download', folder='shared', filename=file) }}" class="btn btn-sm btn-primary">Herunterladen</a>
          {% if username in shared_owners and shared_owners[file] == username %}
          <a href="{{ url_for('delete_file', folder='shared', filename=file) }}" class="btn btn-sm btn-danger ms-2" onclick="return confirm('Datei wirklich löschen?')">Löschen</a>
          {% endif %}
        </span>
      </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>Keine Dateien im gemeinsamen Ordner.</p>
  {% endif %}

  {% if username in ['admin1', 'admin2'] %}
    <a href="{{ url_for('register') }}" class="btn btn-outline-primary mt-3">Neuen Benutzer registrieren</a>
    <a href="{{ url_for('user_list') }}" class="btn btn-outline-secondary mt-3">Benutzerliste</a>
  {% endif %}

  <a href="{{ url_for('download_history') }}" class="btn btn-link mt-3">Download-Historie ansehen</a>
</div>
{% endblock %}
